<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.FiveLastName.TakeBackMapper">

	<!-- 반품 조회 -->
	<!-- 반품신청일  품목명 불량수량 불량수량 반품상태 -->
	<select id="tb_list" resultType="kr.co.FiveLastName.domain.TakeBackDTO">
		SELECT
		tb.tb_returnApplicationDate, pr.pr_name, tb.tb_errorNum, tb.tb_status
		
		FROM takeback tb
		 
		INNER JOIN receivingInspection ri ON tb.ri_id = ri.ri_id
		INNER JOIN progressInspection pi ON ri.pi_id = pi.pi_id
		INNER JOIN staff st ON pi.st_id = st.st_id
		INNER JOIN shippingStatus ss ON pi.ss_id = ss.ss_id
		INNER JOIN purchaseOrder po ON ss.po_id = po.po_id
		INNER JOIN procurementPlanRegistration ppr ON po.ppr_id = ppr.ppr_id
		INNER JOIN contract co ON ppr.co_id = co.co_id
		INNER JOIN estimate es ON co.es_id = es.es_id
		INNER JOIN product pr ON es.pr_id = pr.pr_id
	</select>
	
	<!-- 반품 상세조회 -->
	<!-- 반품신청일 품목명 불량수량 불량사유 반품상태 반품완료일-->
	<select id="tb_selectOne" parameterType="String" resultType="kr.co.FiveLastName.domain.TakeBackDTO">
		SELECT
		tb.tb_returnApplicationDate, pr.pr_name, tb.tb_errorNum, tb.tb_notes, tb.tb_status, tb.tb_returnCompletionDate
		
		FROM takeback tb
		 
		INNER JOIN receivingInspection ri ON tb.ri_id = ri.ri_id
		INNER JOIN progressInspection pi ON ri.pi_id = pi.pi_id
		INNER JOIN staff st ON pi.st_id = st.st_id
		INNER JOIN shippingStatus ss ON pi.ss_id = ss.ss_id
		INNER JOIN purchaseOrder po ON ss.po_id = po.po_id
		INNER JOIN procurementPlanRegistration ppr ON po.ppr_id = ppr.ppr_id
		INNER JOIN contract co ON ppr.co_id = co.co_id
		INNER JOIN estimate es ON co.es_id = es.es_id
		INNER JOIN product pr ON es.pr_id = pr.pr_id
		
		WHERE tb.tb_code = #{tb.tb_code}
	</select>

	<!-- 반품 등록 -->
	<insert id="tb_insert" parameterType="kr.co.FiveLastName.domain.TakeBackDTO">
		INSERT INTO return(tb_code, ri_id, tb_returnApplicationDate, tb_status,
		tb_returnCompletionDate, tb_errorNum, tb_notes)
		VALUES
		(#{tb_code}, #{ri_id}, #{tb_returnApplicationDate}, #{tb_status},
		#{tb_returnCompletionDate},#{tb_errorNum}, #{tb_notes})
	</insert>

	<!-- 반품 수정 -->
	<update id="tb_update" parameterType="kr.co.FiveLastName.domain.TakeBackDTO">
		UPDATE takeback
		SET
		tb_returnApplicationDate = #{tb_returnApplicationDate},
		tb_status = #{tb_status},
		tb_returnCompletionDate = #{tb_returnCompletionDate},
		tb_errorNum = #{tb_errorNum},
		tb_notes = #{tb_notes}
		WHERE tb_code =#{tb_code};
	</update>
	



</mapper>